---
import type { Magazine } from "src/types/microcms/magazine";

import UnderPageLayout from "@layouts/UnderPageLayout.astro";
import { client } from "@libs/microcms";
import NewsBody from "@components/pages/news/NewsBody.svelte";
import { processContent } from "src/utils/processContent";

export const getStaticPaths = async () => {
  const { contents: magazine } = await client.getList<Magazine>({
    endpoint: "magazine",
    queries: { limit: 10, fields: "id" },
  });

  return magazine.map((magazine) => ({ params: { id: magazine.id } }));
};

const { id } = Astro.params;
if (!id) throw new Error("id is required");

const content = await client.getListDetail<Magazine>({
  endpoint: "magazine",
  contentId: id,
});

content.body = processContent(content.body);
---

<UnderPageLayout mainLabel="Magazine" subLabel="マガジン" title="マガジン">
  <NewsBody content={content} />
</UnderPageLayout>
